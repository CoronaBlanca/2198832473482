-- Script para Muscle Legends - Top 10 Fuerza
-- Env√≠a la tabla de clasificaci√≥n a Discord

local HttpService = game:GetService("HttpService")
local Players = game:GetService("Players")

-- CONFIGURACI√ìN
local WEBHOOK_URL = "https://discord.com/api/webhooks/1431137381813321758/xdnFzn4MnZsXydBFEdzL9vRopPZj-TjnCRM1wT5_WSQD5ZmhKUj8L_ogouDHQpnfE1az" -- Reemplaza con tu webhook de Discord

-- Funci√≥n para obtener el top 10 de jugadores por fuerza
local function obtenerTop10()
    local jugadores = {}
    
    for _, jugador in pairs(Players:GetPlayers()) do
        -- Busca la estad√≠stica de fuerza del jugador
        local leaderstats = jugador:FindFirstChild("leaderstats")
        if leaderstats then
            local fuerza = leaderstats:FindFirstChild("Strength") or 
                          leaderstats:FindFirstChild("Fuerza") or
                          leaderstats:FindFirstChild("Power")
            
            if fuerza and fuerza.Value then
                table.insert(jugadores, {
                    nombre = jugador.Name,
                    fuerza = fuerza.Value
                })
            end
        end
    end
    
    -- Ordenar por fuerza (mayor a menor)
    table.sort(jugadores, function(a, b)
        return a.fuerza > b.fuerza
    end)
    
    -- Tomar solo los primeros 10
    local top10 = {}
    for i = 1, math.min(10, #jugadores) do
        table.insert(top10, jugadores[i])
    end
    
    return top10
end

-- Funci√≥n para formatear n√∫meros grandes
local function formatearNumero(num)
    if num >= 1e12 then
        return string.format("%.2fT", num / 1e12)
    elseif num >= 1e9 then
        return string.format("%.2fB", num / 1e9)
    elseif num >= 1e6 then
        return string.format("%.2fM", num / 1e6)
    elseif num >= 1e3 then
        return string.format("%.2fK", num / 1e3)
    else
        return tostring(num)
    end
end

-- Funci√≥n para enviar el embed a Discord
local function enviarADiscord(top10)
    if WEBHOOK_URL == "TU_WEBHOOK_URL_AQUI" then
        warn("‚ö†Ô∏è Por favor configura tu WEBHOOK_URL primero")
        return
    end
    
    -- Crear el campo de descripci√≥n con la tabla
    local descripcion = "```\n"
    descripcion = descripcion .. "Pos | Jugador              | Fuerza\n"
    descripcion = descripcion .. "----+----------------------+-------------\n"
    
    for i, jugador in ipairs(top10) do
        local posicion = string.format("%2d", i)
        local nombre = string.sub(jugador.nombre, 1, 20)
        nombre = nombre .. string.rep(" ", 20 - #nombre)
        local fuerza = formatearNumero(jugador.fuerza)
        
        descripcion = descripcion .. string.format("%s  | %s | %s\n", 
            posicion, nombre, fuerza)
    end
    
    descripcion = descripcion .. "```"
    
    -- Crear el embed
    local embed = {
        ["embeds"] = {{
            ["title"] = "üèÜ TOP 10 - Muscle Legends",
            ["description"] = descripcion,
            ["color"] = 15844367, -- Color dorado
            ["footer"] = {
                ["text"] = "Actualizado: " .. os.date("%d/%m/%Y %H:%M:%S")
            },
            ["thumbnail"] = {
                ["url"] = "https://tr.rbxcdn.com/ed8f3d96e2374e6cd5e6ffb858d47077/150/150/Image/Png"
            }
        }}
    }
    
    -- Enviar el webhook
    local success, err = pcall(function()
        local response = request({
            Url = WEBHOOK_URL,
            Method = "POST",
            Headers = {
                ["Content-Type"] = "application/json"
            },
            Body = HttpService:JSONEncode(embed)
        })
        
        if response.StatusCode == 204 then
            print("‚úÖ Tabla enviada a Discord exitosamente!")
        else
            warn("‚ùå Error al enviar: " .. response.StatusCode)
        end
    end)
    
    if not success then
        warn("‚ùå Error: " .. tostring(err))
    end
end

-- Funci√≥n principal
local function ejecutar()
    print("üîÑ Obteniendo top 10 jugadores...")
    local top10 = obtenerTop10()
    
    if #top10 > 0 then
        print("üìä Top 10 obtenido, enviando a Discord...")
        enviarADiscord(top10)
        
        -- Mostrar en consola tambi√©n
        print("\n=== TOP 10 FUERZA ===")
        for i, jugador in ipairs(top10) do
            print(string.format("%d. %s - %s", i, jugador.nombre, formatearNumero(jugador.fuerza)))
        end
    else
        warn("‚ö†Ô∏è No se encontraron jugadores con estad√≠sticas de fuerza")
    end
end

-- Ejecutar
ejecutar()

-- Opcional: Actualizar autom√°ticamente cada 5 minutos
--[[
spawn(function()
    while wait(300) do -- 300 segundos = 5 minutos
        ejecutar()
    end
end)
]]
